var pungle=(function(f){var d=[0,29,115,9,4,5];var g="images/";var c="images/stores/";var b="storeorder";function m(){f("#allStoresAccordion").accordion({autoHeight:false,collapsible:false,clearStyle:true});f("#ulOverview").sortable({opacity:0.6,revert:100,tolerance:"pointer",helper:"clone",placeholder:"storePlaceHolder",handle:".storeButtonUtility",update:function(){f.cookie(b,f("#ulOverview").sortable("toArray"),{expires:365,path:"/"})}});f("#buttonClearStores").button({icons:{primary:"ui-icon-document-b"}}).click(function(){i()});f("#buttonRestoreDefaults").button({icons:{primary:"ui-icon-refresh"}}).click(function(){h()});f.ajax({url:"data/pungle.json",dataType:"json",success:function(o){var p="";var n=new Date();f("#allStores").empty();f.each(o.store,function(q,r){if(r.live){p='<li><a href="'+r.link+'" target="_blank" title="'+r.desc+'">'+r.name+"</a>";if(r.aff){p+='<span class="pungleRedIcon ui-icon ui-icon-heart" title="Social good is enabled."></span>'}if(r.deals&&(r.deals!="")){f.each(r.deals,function(s,v){var t=new Date(v.starts);var u=new Date(v.expires);if(t<=n&&u>n){p+='<a href="'+v.link+'" title="'+v.what+'" target="_blank"><span class="pungleBlueIcon ui-icon ui-icon-tag"></span></a>'}})}p+='<span id="listS'+r.id+'" class="addStore pungleBlueIcon ui-icon ui-icon-plusthick" title="Add Store to Overview"></span>';f("#allStores").append(p);f("#listS"+r.id).click(function(){pungle.modStoreOverview(r.id,1)})}});l()}})}function k(o,n){if(n!=0&&n!=1){return}f.ajax({url:"data/pungle.json",dataType:"json",success:function(u){var v="";var q=new Date();var t;var w=[];if(f.isArray(o)==false){w[0]=o}else{w=o}for(var r=0,p=w.length;r<p;++r){t=null;for(var s in u.store){if(u.store[s]["id"]==w[r]){t=s;break}}if(t!=null&&u.store[t]["live"]){if(n==1){v='<li id="pS'+u.store[t]["id"]+'" class="storeButton">';v+='<a href="'+u.store[t]["link"]+'" title="'+u.store[t]["desc"]+'" target="_blank"><img class="storeLink" src="'+c+u.store[t]["img"]+'" /></a>';v+='<span class="storeButtonUtility">';v+='<span class="ui-icon ui-icon-arrow-4" title="Drag & Drop"></span>';v+="</span>";v+='<span class="storeButtonBottom">';if(u.store[t]["aff"]){v+='<span class="pungleRedIcon ui-icon ui-icon-heart" title="Social good is enabled."></span>'}if(u.store[t]["deals"]&&(u.store[t]["deals"]!="")){f.each(u.store[t]["deals"],function(x,A){var y=new Date(A.starts);var z=new Date(A.expires);if(y<=q&&z>q){v+='<a href="'+A.link+'" title="'+A.what+'" target="_blank"><span class="pungleBlueIcon ui-icon ui-icon-tag"></span></a>'}})}v+="</span>";v+="</li>";f("#ulOverview").append(v);v='<span id="listS'+u.store[t]["id"]+'" class="addStore pungleRedIcon ui-icon ui-icon-minusthick" title="Remove Store from Overview"></span>';f("#listS"+u.store[t]["id"]).replaceWith(v);(function(x){f("#listS"+x).click(function(){pungle.modStoreOverview(x,0)})})(u.store[t]["id"])}else{f("#pS"+u.store[t]["id"]).remove();v='<span id="listS'+u.store[t]["id"]+'" class="addStore pungleBlueIcon ui-icon ui-icon-plusthick" title="Add Store to Overview"></span>';f("#listS"+u.store[t]["id"]).replaceWith(v);f("#listS"+u.store[t]["id"]).click(function(){pungle.modStoreOverview(u.store[t]["id"],1)})}}}f.cookie(b,f("#ulOverview").sortable("toArray"),{expires:365,path:"/"});e()}})}function l(){var n=f.cookie(b);if(f.url.param("s")&&f.url.param("s")!=" "){d=f.url.param("s").split(";");f.each(d,function(o,p){if(isNaN(p)){alert("This custom URL is malformed. (ew!) No worries, pungle to the rescue!");window.location.hash="#";window.location.reload()}});f.cookie(b,d,{expires:365,path:"/"})}else{if(n){d=n.split(",");f.each(d,function(o,p){d[o]=p.replace("pS","")})}}k(d,1);window.location.hash="#"}function e(){d=f("#ulOverview").sortable("toArray");f.each(d,function(n,o){d[n]=o.replace("pS","")})}function a(){if(window.sidebar){window.sidebar.addPanel(document.title,document.url,"")}else{if(window.external){window.external.AddFavorite(document.url,document.title)}else{alert("Sorry! Your browser doesn't support this function.")}}}function i(){k(d,0);f.cookie(b,null,{path:"/"});window.location.hash="#"}function h(){f.cookie(b,null,{path:"/"});window.location.hash="#";window.location.reload()}function j(){var n="http://"+window.location.hostname+"&s=";f.each(f("#ulOverview").sortable("toArray"),function(o,p){if(o==0){n+=parseInt(p.substring(2),10)}else{n+=";"+parseInt(p.substring(2),10)}});f("#getUrl").html(n)}return{init:m,modStoreOverview:k}}(jQuery));(function(a){a.url={};a.extend(a.url,{_params:{},init:function(){var b="";try{b=(window.location.hash.substring(1)||"").split("#")[0].split("&")||[];for(var c=0;c<b.length;c++){var f=b[c].split("=");if(f[0]){this._params[f[0]]=unescape(f[1])}}}catch(d){alert(d)}},param:function(b){return this._params[b]||""},paramAll:function(){return this._params}});a.url.init()})(jQuery);jQuery.cookie=function(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+(m.path):"";var g=m.domain?"; domain="+(m.domain):"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};